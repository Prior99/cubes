<!DOCTYPE HTML>
<html>
    <head>
        <script type="text/javascript" src="gl-matrix.js"></script>
        <script type="text/javascript" src="graphics.js"></script>
        <script type="text/javascript" src="cube.js"></script>
        <script type="text/javascript" src="game.js"></script>
        <script type="text/javascript" src="shop.js"></script>
        <script type="text/javascript" src="input.js"></script>
        <script type="text/javascript" src="storage.js"></script>
        <script type="text/javascript" src="initgl.js"></script>
        <script type="text/javascript" src="jquery-2.1.1.min.js"></script>
        <style type="text/css">
            body {
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                overflow: hidden;
            }

            canvas {
                position: absolute;
                left: 0;
                right: 0;
                z-index: 50;
            }

            div.underlay {
                position: absolute;
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                z-index: 0;
            }

            div.overlay {
                position: absolute;
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                z-index: 100;
            }
        </style>
    </head>
    <body>
        <div class="overlay">
            HALLO
        </div>
        <canvas width="800" height="600"></canvas>
        <script type="text/javascript">
            var graphics, canvas, cubes;
            canvas = $("canvas")[0];
            cubes = [];

            var cubeTypes = {};
            var cubeTypesLoading = {};

            function getCube(name, callback) {
                if(cubeTypes[name] !== undefined) {
                    cubeTypes[name](callback);
                }
                else {
                    if(cubeTypesLoading[name] !== undefined) {
                        cubeTypesLoading[name].push(callback);
                    }
                    else {
                        cubeTypesLoading[name] = [callback];
                        $.ajax({
                            url : "cubes/" + name,
                            dataType : "text",
                            cache : false,
                            success : function(res) {
                                var c = eval("(" + res + ")");
                                for(cb in cubeTypesLoading[name]) {
                                    c(cubeTypesLoading[name][cb]);
                                }
                                cubeTypesLoading[name] = undefined;
                                cubeTypes[name] = c;
                            }
                        });
                    }
                }
            }

            function resize() {
                graphics.resize(canvas.width = window.innerWidth, canvas.height = window.innerHeight);
            }

            window.addEventListener('resize', function() {
                resize();
            }, false);

            function initGraphics(gl) {
                console.log("Initializing Graphics...");
                graphics = new Graphics(canvas.width, canvas.height, cubes, gl, initShop);
            }

            function initGame() {
                console.log("Initializing Game...");
                var game = new Game(cubes);
                resize();
                console.log("Starting Graphics...");
                graphics.start();
                //graphics.setRotation(Math.PI/2, 0, 0);
                graphics.setPosition(0, 0, -20);
                console.log("Starting Game...");
                game.start();
                console.log("Everything up and running!");
            }

            function initShop() {
                console.log("Initializing Shop...");
                var shop = new Game(cubes);
                resize();
                console.log("Starting Graphics...");
                graphics.start();
                //graphics.setRotation(Math.PI/2, 0, 0);
                graphics.setPosition(10, 0, -20);
                console.log("Starting Shop...");
                shop.start();
                console.log("Everything up and running!");
            }
            initGL(canvas, initGraphics, initShop);
        </script>
    </body>
</html>
